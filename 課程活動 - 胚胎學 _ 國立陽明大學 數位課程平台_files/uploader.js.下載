!function(window,$,fs){'use strict';var self;var Uploader=function(options){self=this;this.options=options;this.queue=[];this.abort=false;this.$list=$(this.options.container);this.item={};this.choosable=false;this.ready=false;this.namespace='original';this.formData=[];this.modal=$(this.tmpl('modal')({lang:this.options.lang}));this.modal.on('click.dismiss.uploader','[data-dismiss="uploader"]',this.hide.bind(this)).appendTo("body");this.$element=$(".modal-uploader[data-role='uploader']").data('uploader',this);this.initUpload();this.featureDetect();if(this.options.data.original){this.addUploadingItem(this.options.data.original.length);this.replaceUploadingItem(this.options.data.original);this.ready=true;}
this.$element.on('click.choose.uploader',".item[data-role='file']",function(e){var target=$(e.target).closest(".item");if(!this.choosable){target.find(".tool").trigger("click.preview.uploader");return false;}
this.item[this.namespace]=this.item[this.namespace]||{};var data=this.item[this.namespace][target.attr('data-id')];if(target.attr('data-url')!==undefined){window.open(target.attr('data-url'));return false;}
var validResult=this.valid(data,this.limit);if(validResult!==true){alert(validResult);return false;}
if(this.callback){this.callback(data);}
this.activeTarget.trigger({'type':'choosed','ret':data});this.hide();}.bind(this));this.$element.on('click.delete.uploader','[data-role="delete"]',this.deleteItem.bind(this));this.$list.on('click.delete.uploader','[data-role="delete"]',this.deleteItem.bind(this));this.$element.on("dragstart",function(){return false;});fs.event.register('forceDelete.item.uploader',function(param){$.each(this.item[this.namespace],function(idx,item){if(item[param.key]===param.value){this.isTrigger=true;this.$element.find("[data-id='"+this.item[this.namespace][idx].id+"']").find("[data-role='delete']").trigger('click.delete.uploader');this.isTrigger=false;}});}.bind(this));fs.event.trigger('ready.uploader');}
Uploader.prototype={constructor:Uploader,toggle:function(){return this[!this.isShown?'show':'hide']();},show:function(){var that=this,e=$.Event('show');that.$element.find("[data-role='uploader-file']").fileupload({pasteZone:$('body'),});if(this.countItem()>0&&['attach','browse'].indexOf(this.mode)!==-1){that.$element.find('.drophere').removeClass('drophere');}
this.$element.trigger(e);if(this.isShown||e.isDefaultPrevented())return;this.isShown=true;this.escape();this.backdrop(function(){var transition=$.support.transition&&that.$element.hasClass('fade');if(!that.$element.parent().length){that.$element.appendTo(document.body);}
that.$element.show();if(transition){that.$element[0].offsetWidth}
that.$element.addClass('in').attr('aria-hidden',false);that.enforceFocus();transition?that.$element.one($.support.transition.end,function(){that.$element.focus().trigger('shown')}):that.$element.focus().trigger('shown');});this.resetProgressBar();this.repositionPreview();this.$element.find("[data-role='uploader-file']").fileupload('enable');},hide:function(e){if(e instanceof Array){e=e[0];}
e&&e.preventDefault();if(this.queue.length){this.abort=confirm(this.options.lang.leavePS)
if(!this.abort){return;}}
var that=this;e=$.Event('hide');this.$element.trigger(e)
if(!this.isShown||e.isDefaultPrevented())return;that.$element.find("[data-role='uploader-file']").fileupload({pasteZone:null,});this.isShown=false;this.escape();$(document).off('focusin.uploader');this.$element.removeClass('in').attr('aria-hidden',true);$.support.transition&&this.$element.hasClass('fade')?this.hideWithTransition():this.hideUploader();if(this.activeTarget.attr('data-no-reload')===undefined){if(['reupload','pdf','ppt','video','repo','cert','album','ecm','audio','exercise','html'].indexOf(that.mode)!==-1){window.location.reload();}}
if(this.activeTarget.attr('data-reload')==true){window.location.reload();}
this.activeTarget.trigger({'type':'close.modal.uploader','ret':{'uploaded':that.uploadCount}});if(this.abort){that.queue.forEach(function(item){item.abort();});}
this.limit='';this.$element.find("[data-role='uploader-file']").fileupload('disable');this.activeTarget=null;this.callback=null;},resetProgressBar:function(){this.$element.find(".bar").removeAttr("style").empty();this.$element.find(".progress").removeClass("progress-danger");},choose:function(){var that=this,args=arguments;that.show();that.activeTarget=$(args[0]);if(typeof args[1]==='function'){that.callback=args[1];return;}else if(typeof args[1]==='object'){that.limit=args[1];if(typeof args[2]==='function'){that.callback=args[2];}
return;}},exports:function(filter){var list=$.map(this.item[this.namespace],function(v,i){if(filter&&filter!=='*'&&v.mimeType.indexOf(filter)!==0){return null;}else{return[v];}});return list;},switchMode:function(mode,choose){var that=this;if(['note','comment','exam'].indexOf(mode)!==-1){that.changeNamespace(mode);}else{that.changeNamespace('original');}
if(mode!=='browse'&&mode!=='album'){that.choosable=true;that.$element.find('[data-role="uploader-choose"]').show();}else{that.choosable=false;that.$element.find('[data-role="uploader-choose"]').hide();}
if(typeof that.options.upload[mode]==='undefined'){var first;for(first in that.options.upload)break;mode=first;}
if(!mode)return;that.enablePreview();that.mode=mode;var uploadOption=that.options.upload[mode],accept=(mode=='attach'&&(choose&&choose['mimeType']!=='undefined'))?choose['mimeType']+'/*':uploadOption.mimeType;if(uploadOption.maxNumberOfFiles<<0===1){that.$element.find('[data-role="uploader-file"]').removeAttr('multiple');}else{that.$element.find('[data-role="uploader-file"]').attr('mutiple','');}
that.$element.find(".item[data-type='attach']").toggleClass('in',mode!=='reupload'&&(mode==='attach'||mode==='browse'||mode==='extImg'||that.namespace!=='original'));that.$element.find("[data-role='uploader-file']").attr('accept',accept).fileupload('option',uploadOption);if(['Safari','Mobile Safari'].indexOf($.ua.browser.name)!==-1){that.$element.find("[data-role='uploader-file']").removeAttr('accept');}
var caption=that.options.upload[mode].caption?that.options.upload[mode].caption:that.options.lang.dropHint;that.modal.find("[data-role='uploader-hint']").html(caption);if(!that.$element.find('.item:visible').length){that.modal.find(".uploader-tips").html(that.options.upload[mode].tips).show();$('[data-role="uploader-item"]').addClass('drophere');}else{that.modal.find(".uploader-tips").hide();$('[data-role="uploader-item"]').removeClass('drophere');}},enableDragAnimation:function(){var that=this;$(document).unbind('dragover.upload.uploader').bind('dragover.upload.uploader',function(e){if((typeof e.originalEvent.dataTransfer.types.contains==='function'&&!e.originalEvent.dataTransfer.types.contains('Files'))||(!e.originalEvent.dataTransfer.types.contains&&e.originalEvent.dataTransfer.types.indexOf('Files')===-1)){return false;}
var dropZone=that.$element,timeout=window.uploaderTimeout;if(!timeout){dropZone.addClass('drag');}else{clearTimeout(timeout);}
if(e.target==dropZone[0]||$(e.target).closest(".modal-uploader[data-role='uploader']").length>0){dropZone.addClass('draghover');}else{dropZone.removeClass('draghover');}
window.uploaderTimeout=setTimeout(function(){window.uploaderTimeout=null;dropZone.removeClass('drag draghover');},100);});},disableDragAnimation:function(){$(document).unbind('dragover.upload.uploader');window.uploaderTimeout=null;},enablePreview:function(){var that=this;if(that.$element.find('.extra[data-role="uploader-extra"]').length){return;}
var previewBox=that.tmpl('previewBox')({lang:that.options.lang});that.$element.find('[data-role="uploader-item"]').append(previewBox);var preview=that.$element.find('.extra[data-role="uploader-extra"]'),chooseEle=preview.find("[data-role='uploader-choose']"),oriFileEle=preview.find("[data-role='uploader-oriFile']"),deleteEle=preview.find("[data-role='uploader-delete']"),changeFileNameEle=preview.find("[data-role='uploader-changeFileName']");that.$element.off('click.preview.uploader').on('click.preview.uploader',".item .tool",function(e){var item=$(this).closest('.item'),features=['filename','size','imgSize','mimeType'];for(var k in features){var itemData=$.extend({},that.item[that.namespace][item.attr('data-id')]),target=preview.find("[data-placement='"+features[k]+"']");if(features[k]==='size'){itemData[features[k]]=fs.util.byteFormat(itemData[features[k]]);}
if(features[k]==='mimeType'){var downloadUrl=(itemData[features[k]].indexOf('image')===0)?itemData['downloadUrl']:itemData['thumbUrl'];preview.find('.preview-body').html("<img src='"+downloadUrl+"'/>");oriFileEle.attr({href:that.item[that.namespace][item.attr('data-id')]['cdnDownloadUrl'],target:'_blank'});}
target.text(itemData[features[k]]).attr('title',itemData[features[k]]);(itemData[features[k]]===undefined||itemData[features[k]]==='')?target.closest('li').hide():target.closest('li').show();}
chooseEle.attr('data-target',item.attr('data-id'));deleteEle.attr('data-target',item.attr('data-id'));changeFileNameEle.attr('data-target',item.attr('data-id'));that.repositionPreview(item);return false;});deleteEle.bind('click.delete.preview.uploader',function(e){that.$element.find("[data-id='"+$(this).attr('data-target')+"'] [data-role='delete']").trigger('click.delete.uploader');that.repositionPreview($(this).closest('.item'));});chooseEle.bind('click.choose.preview.uploader',function(e){that.$element.find("[data-id='"+$(this).attr('data-target')+"']").trigger('click.choose.uploader');});changeFileNameEle.bind('click.changefilename.preview.uploader',$.proxy(that.changeFileName,that));},disablePreview:function(){$('.extra[data-role="uploader-extra"]').remove();},enableMini:function(){var that=this;that.$element.addClass('modal-uploader-mini');},disableMini:function(){var that=this;that.$element.removeClass('modal-uploader-mini');},deleteItem:function(e){var target=$(e.target).closest(".item");if(this.isTrigger||confirm(this.options.lang.cfmDel)){$.post(this.item[this.namespace][$(target).attr('data-id')]['deleteUrl'],function(obj){if(obj.ret.msg==='false'){alert(obj.ret.msg);return;}
fs.util.refrashImg();target.hide('fast',function(){delete(this.item[this.namespace][target.attr('data-id')]);if(!Object.keys(this.item[this.namespace]).length){this.options.data[this.namespace]=[];}
this.$element.find("[data-id='"+target.attr('data-id')+"']").remove();this.renderList();}.bind(this));this.repositionPreview();}.bind(this),'json');}
return false;},changeNamespace:function(namespace){this.namespace=namespace;this.item[this.namespace]=this.item[this.namespace]||{};this.refrashUploadingItem();},refrashUploadingItem:function(){var $container=this.$element.find('[data-role="uploader-item"]');$container.empty();var data=Object.keys(this.item[this.namespace]).length?this.item[this.namespace]:this.options.data[this.namespace]||{};this.addUploadingItem(Object.keys(data).length);this.replaceUploadingItem(data);},addUploadingItem:function(num){var pool=[];for(var i=0;i<num;i++){pool.push(this.tmpl("uploadingItem")());};this.$element.find('[data-role="uploader-item"]').append(pool);this.modal.find(".uploader-tips").hide();this.repositionPreview();},replaceUploadingItem:function(data){if(!data)return;var that=this;$.each(data,function(idx,item){var dataUrl,delteeImg='',style='';switch(that.mode){case'attach':case'extImg':dataUrl="data-type='attach'";delteeImg="<img src='"+that.options.img.remove+"' class='cross' data-role='delete'>";break;case'album':dataUrl="data-type='upload'";style=" style='display:none;' ";break;case'examExam':case'examCsv':case'pollPoll':case'pollCsv':dataUrl="data-type='attach' style='display:none'";break;default:if(that.namespace==='original'){dataUrl="data-type='upload' data-url='"+item.url+"'";}else{dataUrl="data-type='attach'";delteeImg="<img src='"+that.options.img.remove+"' class='cross' data-role='delete'>";}
break;}
var ele="\
                    <li class='item in' data-role='file' data-id='"+item.id+"' "+dataUrl+">\
                        <a class='thumbnail'>\
                            <div class='tool'>\
                                <i class='icon-white icon-search pull-right' "+style+"></i>\
                                <div class='filename' title='"+fs.util.escape(item.filename)+"'>\
                                    <div class='name'>"+fs.util.escape(item.name)+"</div>\
                                    <div class='ext'>"+fs.util.escape(item.ext)+"</div>\
                                </div>\
                            </div>"+delteeImg+"<img src='"+item.thumbUrl+"' alt='"+fs.util.escape(item.filename)+"'>\
                        </a>\
                    </li>";that.$element.find('.uploading').get(0).outerHTML=ele;that.item[that.namespace]=that.item[that.namespace]||{};that.item[that.namespace][item.id]=item;if(that.ready){fs.event.trigger('insert.item.uploader',that.item[that.namespace][item.id]);}else{fs.event.trigger('init.item.uploader',that.item[that.namespace][item.id]);}});that.repositionPreview();that.renderList();},onError:function(e,data){this.$element.find('.progress[data-role="uploader-progress"]').removeClass("progress-success active").addClass('progress-danger');this.$element.find("button[data-role='closeModalBtn']").html(this.options.lang.close).prop('disabled',false).removeClass("btn-success");$(window).unbind('beforeunload.upload.uploader');if(!this.abort){if(data.errorThrown){if(!data.errorThrown.message){alert(data.errorThrown);return;}
var errorKeyword=data.errorThrown.message.substr(-1);switch(errorKeyword){case'<':alert('Uploader: `'+this.mode+'` have some error');break;case'F':alert('Uploader: `'+this.mode+'` have some fatal error');break;case'W':alert('Uploader: `'+this.mode+'` have some warning');break;default:alert(data.errorThrown.message);}
console.log("Error Message: "+data.errorThrown.message)
console.log("PageId: "+$("body").attr('data-page-id'));console.log("Permission: "+$("body").attr('data-page-priv'));console.log("Debug Step:");console.log("1. Switch to tab 'Network' and uplaod again");console.log("2. Click XHR '/ajax/sys.modules.mod_fileUpload/xxx'");console.log("3. Click tab 'Response' to see what's going on");}}
this.$element.find('.uploading').eq(0).remove();},renderList:function(){var that=this,pool=[],sn=0;$.each(that.item['original']||[],function(idx,item){pool.push(that.tmpl("listItem")({data:item,sn:++sn,lang:that.options.lang}));});if(!pool.length){this.modal.find(".uploader-tips").show();}else{this.modal.find(".uploader-tips").hide();}
var box=$("<ol class='uploader-list'></ol>").append(pool);$(that.options.container).empty().append(box);},countItem:function(){return Object.keys(this.item['original']).length;},valid:function(data,limit){var that=this,errorMsg=[];if(!limit){return true;}
if(limit['mimeType']&&limit['mimeType']!=='*'&&data['mimeType'].indexOf(limit['mimeType'])===-1){errorMsg.push(that.options.lang.mimeTypeNotMatch);}
if(data['mimeType']==='*'||data['mimeType'].indexOf("image")===0){if(data['mimeType'].indexOf("x-icon")!==-1){return true;}
var dim=data['imgSize'].split("x");if(limit['minWidth']&&parseInt(limit['minWidth'],10)>parseInt(dim[0],10)){errorMsg.push(that.options.lang.imgWidthTooSmall+" "+limit['minWidth']+" "+that.options.lang.pixel);}
if(limit['minHeight']&&parseInt(limit['minHeight'],10)>parseInt(dim[1],10)){errorMsg.push(that.options.lang.imgHeightTooSmall+" "+limit['minHeight']+" "+that.options.lang.pixel);}
if(limit['maxWidth']&&parseInt(limit['maxWidth'],10)<parseInt(dim[0],10)){errorMsg.push(that.options.lang.imgWidthTooLarge+" "+limit['maxWidth']+" "+that.options.lang.pixel);}
if(limit['maxHeight']&&parseInt(limit['maxHeight'],10)<parseInt(dim[1],10)){errorMsg.push(that.options.lang.imgHeightTooLarge+" "+limit['maxHeight']+" "+that.options.lang.pixel);}}
return errorMsg.length?errorMsg.join("\n"):true;},clearFormData:function(){this.formData=[];},addFormData:function(o){if(typeof o!=='object'){return;}
this.formData.push(o);this.$element.find("[data-role='uploader-file']").fileupload({formData:this.formData});},initUpload:function(){var that=this,uploadEle=that.$element.find("[data-role='uploader-file']"),progressEle=that.$element.find('.progress[data-role="uploader-progress"]'),closeEle=that.$element.find("button[data-role='closeModalBtn']");uploadEle.fileupload({messages:that.options.messages,dataType:'json',dropZone:that.$element,add:function(e,data){if(e.isDefaultPrevented()){return false;}
if(data.autoUpload||(data.autoUpload!==false&&$(this).fileupload('option','autoUpload'))){data.process($.proxy(function(){return $(this).fileupload('process',data);},this)).done(function(){that.queue.push(data.submit());that.addUploadingItem(1);});}},submit:function(e,data){var privSelect=$('.modal-uploader .priv-select');if(privSelect.length>0){$.uploader('addFormData',{name:'priv',value:privSelect.val()});privSelect.prop('disabled',true);}},start:function(e){that.$element.find('.drophere').removeClass('drophere');this.queue=[];this.abort=false;$(window).bind('beforeunload.upload.uploader',function(){return that.options.lang.leavePS;});},done:function(e,data){var pool=[];$.each(data.result.files,function(index,file){if(typeof file.error!=='undefined'){alert(file.error);that.onError(e,data);return;}
var nameArray=fs.util.parseFileName(file.oriFileName);pool.push($.extend(file,{id:file.id,filename:file.oriFileName,url:file.url,name:nameArray[0],ext:nameArray[1].length>0?"."+nameArray[1]:"",size:file.size,mimeType:file.type,imgSize:file.imgSize,thumbUrl:file.thumbnail_url,deleteUrl:file.delAuth,downloadUrl:file.url,cdnDownloadUrl:file.cdn_url,apiUrl:file.apiUrl,createTime:file.createTime}));that.$element.focus().trigger('file-uploaded',file);});that.replaceUploadingItem(pool);that.repositionPreview();},progressall:function(e,data){data.loaded=data.loaded>data.total?data.total:data.loaded;var progress=parseFloat(data.loaded/data.total*100).toFixed(0);progressEle.find('.bar').css('width',progress+'%').html(progress+'%');if(data.loaded===data.total){$(window).unbind('beforeunload.upload.uploader');progressEle.toggleClass('active',false).removeClass('progress-danger');closeEle.html(that.options.lang.close);that.queue=[];that.abort=false;}else{progressEle.toggleClass('active',true);closeEle.html(that.options.lang.cancel);}
fs.event.trigger('uplaod.item.uploader',{mode:that.mode,total:data.total,loaded:data.loaded,progress:progress});},getNumberOfFiles:that.countItem.bind(that)}).bind('fileuploadfail',that.onError.bind(that)).bind('fileuploadprocessfail',function(e,data){alert(data.files[0].error);});that.switchMode();},featureDetect:function(){var that=this;if(!('draggable'in document.createElement('span'))){$(document).unbind('dragover.upload.uploader');that.$element.find("span[data-role='uploader-hint']").html("&nbsp;");}
if(!!(window.XMLHttpRequest&&window.FileReader))return;$.getScript(that.options.script.iframeTransport,function(data,textStatus,jqxhr){that.$element.find('[data-role="uploader-file"]').fileupload('option',{forceIframeTransport:true,limitConcurrentUploads:undefined,maxChunkSize:undefined}).removeAttr('multiple');});},changeFileName:function(e){var id=$(e.target).attr('data-target'),item=this.item[this.namespace][id],newName=prompt(this.options.lang.enterFileName,item['name']);if(newName===null){return;}
if(newName===''){alert(this.options.messages.filenameEmpty);return;}
$.post(this.options.ajax.changeFileName,{id:id,name:newName},$.proxy(function(obj){if(obj.ret.status!=='true'){alert(obj.ret.msg);return;}
this.item[this.namespace][id]['name']=newName;this.item[this.namespace][id]['filename']=newName+this.item[this.namespace][id]['filename'].substr(this.item[this.namespace][id]['filename'].lastIndexOf("."));this.renderList();$("[data-placement='filename']").text(this.item[this.namespace][id]['filename']).attr('title',this.item[this.namespace][id]['filename']);$(".modal-uploader").find("[data-id='"+id+"'] .filename").attr('title',this.item[this.namespace][id]['filename']).find(".name").text(newName);},this),'json');},repositionPreview:function(item){var preview=this.$element.find('.extra[data-role="uploader-extra"]'),container=this.$element.find('.thumbnails[data-role="uploader-item"]');if(preview.length===0){return;}
if(item&&preview.attr('data-target')===item.attr('data-id')){preview.toggleClass('in');return;}
if(item===undefined){preview.appendTo(container).removeClass('in').appendTo(container);}else{var preLen=item.prevAll(".item.in").length,nextLen=item.nextAll(".item.in").length,colOfRow=this.$element.hasClass('modal-uploader-mini')?3:6;if(preLen%colOfRow===colOfRow-1){preview.insertAfter(item).addClass('in');}else{var endOfLine=colOfRow-(preLen%colOfRow)-1;if(nextLen>endOfLine){preview.insertAfter(this.$element.find('.item.in').eq(preLen+endOfLine)).addClass('in');}else{preview.appendTo(container).addClass('in');}}
preview.attr('data-target',item.attr('data-id'));$(".thumbnails[data-role='uploader-item']").scrollTo(item);}},enforceFocus:function(){var that=this;$(document).on('focusin.uploader',function(e){if(that.$element[0]!==e.target&&!that.$element.has(e.target).length){that.$element.focus();}});},escape:function(){var that=this
if(this.isShown&&this.options.keyboard){this.$element.on('keyup.dismiss.uploader',function(e){e.which==27&&that.hide();})}else if(!this.isShown){this.$element.off('keyup.dismiss.uploader')}},hideWithTransition:function(){var that=this,timeout=setTimeout(function(){that.$element.off($.support.transition.end);that.hideUploader();},500)
this.$element.one($.support.transition.end,function(){clearTimeout(timeout);that.hideUploader();})},hideUploader:function(){this.$element.hide().trigger('hidden');this.backdrop();},removeBackdrop:function(){this.$backdrop.remove();this.$backdrop=null;},backdrop:function(callback){var that=this,animate=this.$element.hasClass('fade')?'fade':''
if(this.isShown&&this.options.backdrop){var doAnimate=$.support.transition&&animate;this.$backdrop=$('<div class="modal-backdrop '+animate+'" />').appendTo(document.body)
this.$backdrop.click(this.options.backdrop=='static'?$.proxy(this.$element[0].focus,this.$element[0]):$.proxy(this.hide,this));if(doAnimate)this.$backdrop[0].offsetWidth
this.$backdrop.addClass('in');doAnimate?this.$backdrop.one($.support.transition.end,callback):callback();}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass('in');$.support.transition&&this.$element.hasClass('fade')?this.$backdrop.one($.support.transition.end,$.proxy(this.removeBackdrop,this)):this.removeBackdrop();}else if(callback){callback();}},tmpl:function(name){switch(name){case'uploadingItem':return fs.tmpl("<li class='item in uploading'></li>");case'listItem':return fs.tmpl("<li class='item' data-id='{%= o.data.id%}' >\
                                        {% if ( o.data.deleteUrl !== '') { %}\
                                        <div class='main editable'>\
                                        {% } else { %}\
                                        <div class='main'>\
                                        {% } %}\
                                            <span class='sn'>{%= o.sn %}.</span> \
                                            <a href='{%= o.data.cdnDownloadUrl %}' target='_blank' title='{%=o.data.filename%} ({% print(fs.util.byteFormat(o.data.size));%})'>{%=o.data.filename%}</a>\
                                            <span class='hint'>({% print(fs.util.byteFormat(o.data.size, 1, 'KB'));%})</span>\
                                            {% if ( o.data.deleteUrl !== '') { %}<button class='close' data-role='delete' title='{%= o.lang.remove%}'>&times;</button>{% } %}\
                                        </div>\
                                    </li>");case'previewBox':return fs.tmpl("<li class='extra clearfix' data-role='uploader-extra'>\
                                        <div class='row-fluid'>\
                                            <div class='span8 preview'>\
                                                <div class='preview-body'>\
                                                </div>\
                                            </div>\
                                            <div class='span4 detail'>\
                                                <ul class='info'>\
                                                    <li>{%= o.lang.filename %}: <span data-placement='filename'></span></li>\
                                                    <li>{%= o.lang.filesize %}: <span data-placement='size'></span></li>\
                                                    <li>{%= o.lang.imgsize %}: <span data-placement='imgSize'></span></li>\
                                                    <li>{%= o.lang.mimetype %}: <span data-placement='mimeType'></span></li>\
                                                    <li><a data-role='uploader-oriFile'>{%= o.lang.oriFile %}</a></li>\
                                                </ul>\
                                                <div class='action'>\
                                                    <button data-role='uploader-choose' class='btn btn-small btn-success'>{%= o.lang.choose %}</button>\
                                                    <button data-role='uploader-delete' class='btn btn-small btn-danger'>{%= o.lang.remove %}</button>\
                                                    <button data-role='uploader-changeFileName' class='btn btn-small btn'>{%= o.lang.changeFileName %}</button>\
                                                </div>\
                                            </div>\
                                        </div>\
                                    </li>");case'modal':return fs.tmpl("<div class='modal modal-uploader hide fade' tabindex='-1' data-role='uploader' aria-labelledby='uploadBoxLabel' aria-hidden='true'>\
                                        <div class='modal-header text-center'>\
                                            <button type='button' class='close' data-dismiss='uploader' aria-hidden='true'>&times;</button>\
                                            <span data-role='uploader-hint'>{%= o.lang.dropHint %}</span>\
                                        </div>\
                                        <div class='modal-body'>\
                                            <div class='row-fluid'>\
                                                <div class='span12'>\
                                                    <div class='uploader-tips'></div>\
                                                    <ul data-role='uploader-item' class='thumbnails drophere'>\
                                                    </ul>\
                                                </div>\
                                            </div>\
                                        </div>\
                                        <div class='modal-footer clearfix'>\
                                            <button type='button' class='btn btn-mini btn-dismiss' data-role='closeModalBtn' data-dismiss='uploader'>{%= o.lang.close %}</button>\
                                            <div class='text-center pull-left'>\
                                                <span class='btn btn-mini btn-primary btn-uploader pull-left'>\
                                                    <span>{%= o.lang.upload %}</span>\
                                                    <input data-role='uploader-file' type='file' name='files[]' multiple>\
                                                </span>\
                                            </div>\
                                            <div data-role='uploader-progress' class='progress progress-success progress-striped active'>\
                                                <div class='bar'></div>\
                                            </div>\
                                        </div>\
                                    </div>");case'priv-select':return fs.tmpl("\
                        <select class='priv-select'>\
                            <option value='0'>{%= o.lang.public %}</option>\
                            <option value='1'>{%= o.lang.nonpublic %}</option>\
                        </select>");default:throw"tmpl `"+name+"` not exist";}}}
var old=$.uploader;$.uploader=function(option){var $modal=$(".modal-uploader[data-role='uploader']"),data=$modal.data('uploader'),options=$.extend(true,{},$.uploader.defaults,$modal.data(),typeof option=='object'&&option);if(!data){$modal.data('uploader',(data=new Uploader(options)));}else{$.extend($modal.data('uploader').options,option);}
if(typeof option==='string'){return data[option].apply(data,Array.prototype.slice.call(arguments,1));}else{if(options.show){data.show();}
(options.dragAnimation)?data.enableDragAnimation():data.disableDragAnimation();(options.preivew)?data.enablePreview():data.disablePreview();(options.mini)?data.enableMini():data.disableMini();}}
$.uploader.defaults={backdrop:true,keyboard:true,show:false,mini:false,dragAnimation:true,preivew:true,mode:'attach',lang:{'dropHint':'Drop here','remove':'Delete','close':'Close','choose':'Choose','upload':'Upload','filename':'Filename','filesize':'Filesize','imgsize':'Imgsize','mimetype':'Mimetype','oriFile':'Original file','uploading':'Uploading','cfmDel':'Do you really want to delete this file?','leavePS':'File is uploading, exit this page anyway?','mimeTypeNotMatch':'MimeType dismatch','imgWidthTooSmall':'Image width should bigger than','imgWidthTooLarge':'Image width should smaller than','imgHeightTooSmall':'Image height should bigger than','imgHeightTooLarge':'Image height should smaller than','pixel':'pixel','changeFileName':'Change file name','enterFileName':'Please enter new file name',},messages:{'maxNumberOfFiles':'Maximum number of files exceeded','acceptFileTypes':'File type not allowed','maxFileSize':'File is too large','minFileSize':'File is too small','filenameEmpty':'File name can not be empty'},img:{'remove':'/sys/res/icon/cross-black.png'},script:{iframeTransport:'/sys/js/jquery.iframe-transport.js'},container:undefined,data:[],ajax:{},upload:{},choose:{mimeType:undefined,maxHeight:0,minHeight:0,maxWidth:0,minWidth:0}}
$.uploader.Constructor=Uploader;$.uploader.noConflict=function(){$.uploader=old;return this;}
$(document).on('click.uploader.data-api','[data-toggle="uploader"]',function(e){e.preventDefault();var $this=$(this),$modal=$(".modal-uploader[data-role='uploader']"),option=$modal.data('uploader')?'toggle':$modal.data('uploader'),limit={mimeType:$this.attr('data-mimeType')||'*',maxHeight:$this.attr('data-maxHeight')||0,maxWidth:$this.attr('data-maxWidth')||0,minHeight:$this.attr('data-minHeight')||0,minWidth:$this.attr('data-minWidth')||0},choose=$.extend($.uploader.defaults.choose,limit),uplaodUrl=$this.attr('data-uploadUrl');var mode=$this.attr('data-mode');var o=$modal.data('uploader').options.upload;o[mode]=o[mode]||{};o[mode].caption=$this.attr('data-caption')||o[mode].caption;$.uploader(option);if(uplaodUrl){o[mode].url=uplaodUrl;o[mode].mimeType=limit.mimeType;o[mode].maxNumberOfFiles=$this.attr('data-maxNumberOfFiles')
o[mode].tips=$this.attr('data-tips');}
$modal.find('.priv-select').remove();if(o[mode].showPrivSelect){$modal.find('.modal-footer [data-role="closeModalBtn"]').after($(self.tmpl('priv-select')({lang:self.options.lang})));}
$.uploader('clearFormData');$.each(this.attributes,function(index,attr){var nodeName=attr.nodeName.toString();if(nodeName.match(/^data\-param\-.+/)){$.uploader('addFormData',{name:nodeName.substr(11),value:attr.value});}});$.uploader('switchMode',mode,choose);$.uploader('choose',this,choose);});}(window,window.jQuery,window.fs);